# **Story 2.5: OWASP Cheat Sheet Ingestion**

**Epic:** IDE Agent Integration (Claude Code MVP)

## **User Story**

* **As a** Security-Focused Architect (Leo),
* **I want** the system to automatically ingest and normalize security guidance from OWASP Cheat Sheets into Rule Cards,
* **so that** developers receive comprehensive, industry-standard security guidance without manual rule card creation overhead.

## **Context and Dependencies**

This story implements **FR2: Hybrid Knowledge Ingestion** from the PRD, specifically the external sources component. It builds upon the semantic search infrastructure from Story 2.4 to provide a dramatically expanded knowledge base.

**Current State:**
- 15 manually created Rule Cards across 5 security domains
- Local semantic search with limited corpus (Story 2.4)
- Manual rule card creation process

**Target State:**
- 100+ Rule Cards automatically generated from OWASP Cheat Sheets
- Comprehensive coverage of 20+ security domains
- Automated ingestion pipeline with version tracking
- Enhanced semantic search corpus with industry-standard guidance

**Dependencies:**
- ✅ **Story 2.1**: Agentic Runtime Core (provides agent package compilation)
- ✅ **Story 2.2**: Claude Code Sub-Agent (provides real-time guidance delivery)  
- ✅ **Story 2.3**: Manual On-Demand Execution (provides manual analysis commands)
- ✅ **Story 2.4**: Semtools Semantic Search (provides corpus management infrastructure)

## **Acceptance Criteria**

### **Task 1: OWASP Content Acquisition and Parsing**
1. Script fetches OWASP Cheat Sheet markdown directly from GitHub repository (e.g., https://github.com/OWASP/CheatSheetSeries/blob/master/cheatsheets/JSON_Web_Token_for_Java_Cheat_Sheet.md)
2. Raw markdown content is acquired from raw.githubusercontent.com for secure, direct access
3. Content versioning tracks OWASP updates and changes over time via Git commit hashes
4. Parsing extracts markdown structure for LLM processing without complex format handling

### **Task 2: Content Normalization and Rule Card Generation**
1. ChatGPT processes OWASP markdown content with structured prompts and example Rule Card templates
2. Generated Rule Cards follow the established schema (id, title, severity, scope, requirement, do, dont, detect, verify, refs)
3. LLM-based approach extracts actionable security requirements from natural language content
4. Multiple Rule Cards can be generated from a single comprehensive cheat sheet using intelligent content segmentation

### **Task 3: Scanner Integration Mapping**
1. Generated Rule Cards include appropriate scanner configurations (Semgrep, TruffleHog, CodeQL)
2. OWASP guidance is mapped to existing scanner rule databases
3. Custom detection patterns are created when no existing scanner rules exist
4. Scanner integration maintains consistency with manually created Rule Cards

### **Task 4: Corpus Integration and Semantic Enhancement**
1. Generated Rule Cards are automatically integrated into the semantic search corpus
2. OWASP-sourced content is clearly identified with provenance tracking
3. Semantic search can differentiate between internal and OWASP-sourced guidance
4. Corpus size remains manageable (<500MB) with intelligent content selection

### **Task 5: Ingestion Pipeline and Automation**
1. Automated ingestion pipeline can be triggered manually or on schedule
2. Pipeline validates generated Rule Cards against schema requirements
3. Duplicate detection prevents redundant Rule Cards from multiple sources
4. Change detection identifies when OWASP content has been updated

### **Task 6: Quality Assurance and Validation**
1. Generated Rule Cards pass the same validation as manually created cards
2. Content quality metrics ensure actionable, accurate guidance
3. Generated Rule Cards integrate seamlessly with existing agent packages
4. Performance impact of expanded corpus remains within acceptable limits (<2s response time)

## **Security Requirements**

1. **Content Integrity**: OWASP content is validated for tampering during ingestion
2. **Source Verification**: Only official OWASP sources are permitted for ingestion  
3. **Sanitization**: All ingested content is sanitized to prevent injection attacks
4. **Access Control**: Ingestion pipeline requires appropriate authorization
5. **Audit Trail**: Complete logging of all ingestion activities and content changes

## **Non-Functional Requirements**

1. **NFR1 (Performance)**: Rule Card generation completes within 10 minutes for full OWASP corpus
2. **NFR2 (Quality)**: Generated Rule Cards maintain 90%+ accuracy compared to manual review
3. **NFR3 (Coverage)**: Ingestion captures 80%+ of actionable security guidance from each cheat sheet
4. **NFR4 (Compatibility)**: Generated Rule Cards maintain full compatibility with existing Stories 2.1-2.4

## **Technical Architecture**

### **Components**
```
app/
├── ingestion/                   # OWASP Cheat Sheet ingestion pipeline (NEW)
│   ├── __init__.py
│   ├── owasp_fetcher.py        # OWASP content acquisition and caching
│   ├── content_parser.py       # Markdown parsing and structure extraction
│   ├── rule_card_generator.py  # OWASP -> Rule Card YAML conversion
│   ├── scanner_mapper.py       # Scanner rule mapping and integration
│   ├── quality_validator.py    # Generated content validation
│   └── ingestion_pipeline.py   # End-to-end ingestion orchestration
├── semantic/                    # Enhanced corpus management (MODIFIED)
│   ├── corpus_manager.py       # Enhanced with OWASP content integration
│   └── ...                     # Existing semantic search components
└── rule_cards/                  # Expanded rule card collection (MODIFIED)
    ├── owasp/                  # OWASP-generated Rule Cards (NEW)
    │   ├── authentication/     # 10+ authentication cheat sheets
    │   ├── input_validation/   # 8+ input validation cheat sheets  
    │   ├── cryptography/       # 6+ cryptography cheat sheets
    │   ├── web_security/       # 15+ web security cheat sheets
    │   └── ...                 # Additional OWASP domains
    └── ...                     # Existing manually created Rule Cards
```

### **Data Flow**
1. **Content Acquisition**: Fetch OWASP cheat sheets → Local caching → Version tracking
2. **Content Processing**: Markdown parsing → Structure extraction → Content normalization
3. **Rule Card Generation**: Extract requirements → Generate YAML → Scanner mapping
4. **Quality Validation**: Schema validation → Content quality checks → Duplicate detection  
5. **Integration**: Corpus integration → Agent compilation → Semantic search enhancement

## **Implementation Plan**

### **Phase 1: Infrastructure and Content Acquisition (3-4 days)**
- Set up OWASP content fetching with caching and versioning
- Implement Markdown parsing for various cheat sheet formats
- Create content structure extraction and normalization
- Build basic Rule Card generation framework

### **Phase 2: Rule Card Generation and Quality (4-5 days)**
- Implement comprehensive Rule Card YAML generation
- Create scanner rule mapping and integration system
- Build content quality validation and metrics
- Implement duplicate detection and conflict resolution

### **Phase 3: Integration and Enhancement (3-4 days)**
- Integrate generated Rule Cards with existing semantic search corpus
- Enhance corpus management for OWASP content handling
- Update agent compilation to include OWASP-sourced Rule Cards
- Implement provenance tracking and source identification

### **Phase 4: Pipeline Automation and Polish (2-3 days)**
- Create end-to-end automated ingestion pipeline
- Implement scheduling and change detection capabilities
- Complete comprehensive testing and performance validation
- Documentation and deployment preparation

## **Testing Strategy**

### **Unit Tests**
- OWASP content fetching and caching reliability
- Markdown parsing accuracy across different formats
- Rule Card generation schema compliance  
- Scanner mapping correctness and coverage

### **Integration Tests**
- End-to-end ingestion pipeline functionality
- Generated Rule Card compilation and agent integration
- Semantic search corpus integration and searching
- Performance impact validation with expanded corpus

### **Quality Tests**
- Generated Rule Card accuracy vs manual review
- Content coverage metrics across OWASP cheat sheets
- Scanner integration effectiveness validation
- Consistency with existing manually created Rule Cards

### **Performance Tests**
- Ingestion pipeline completion time under 10 minutes
- Agent response time remains <2s with expanded corpus  
- Semantic search performance with 500MB+ corpus
- Memory usage and resource consumption validation

## **Success Metrics**

### **Quantitative Metrics**
- **Coverage**: Generate 100+ Rule Cards from 50+ OWASP cheat sheets
- **Quality**: 90%+ accuracy rate compared to manual review
- **Performance**: <2s agent response time maintained
- **Completeness**: 80%+ of actionable guidance captured per cheat sheet

### **Qualitative Metrics**
- Generated Rule Cards integrate seamlessly with existing workflow
- Developers report improved coverage of security scenarios
- Security team confirms accuracy and relevance of OWASP-sourced guidance
- Corpus search results include relevant OWASP content with proper attribution

## **OWASP Cheat Sheet Scope**

### **Priority 1 - Core Security Domains (30 cheat sheets)**
- **Authentication**: Authentication, Session Management, Forgot Password
- **Authorization**: Authorization, Access Control
- **Input Validation**: Input Validation, SQL Injection Prevention, XSS Prevention
- **Web Security**: CSRF Prevention, Clickjacking Defense, Content Security Policy
- **Cryptography**: Cryptographic Storage, TLS Configuration, Certificate Pinning
- **API Security**: REST Security, GraphQL Security, API Gateway Security

### **Priority 2 - Advanced Security Topics (20 cheat sheets)**
- **Mobile Security**: iOS Security, Android Security, Mobile Top 10
- **Cloud Security**: Cloud Architecture, Container Security, Serverless Security
- **DevSecOps**: Secure SDLC, Threat Modeling, Security Testing
- **Emerging Technologies**: AI/ML Security, IoT Security, Blockchain Security

### **Priority 3 - Specialized Topics (10 cheat sheets)**
- **Language-Specific**: Java Security, .NET Security, Python Security
- **Framework-Specific**: Spring Security, Django Security, React Security
- **Infrastructure**: Network Security, Database Security, OS Hardening

## **Definition of Done**

- [ ] All acceptance criteria completed and tested (6 tasks)
- [ ] OWASP content ingestion pipeline operational and automated
- [ ] 100+ Rule Cards generated from OWASP cheat sheets with quality validation
- [ ] Generated Rule Cards fully integrated with semantic search and agent compilation
- [ ] Scanner integration maintains consistency with manually created Rule Cards  
- [ ] Performance requirements met (<2s response, <10min ingestion)
- [ ] Comprehensive test coverage for all ingestion and generation components
- [ ] Documentation updated with OWASP ingestion capabilities and procedures
- [ ] FR2 (Hybrid Knowledge Ingestion) fully implemented per PRD requirements

## **Story Points**
**Estimated: 13 points** (Extra Large - requires content processing, automated generation, quality assurance, and integration across multiple system components)

## **Status**
**Current Status:** Ready for Development
**Created:** 2025-08-31
**Last Updated:** 2025-08-31

---

## **Dev Agent Record**

### **Agent Model Used**
Claude 3.5 Sonnet (claude-3-5-sonnet-20241022)

### **Tasks**
- [x] Task 1: OWASP Content Acquisition and Parsing
- [ ] Task 2: Content Normalization and Rule Card Generation
- [ ] Task 3: Scanner Integration Mapping
- [ ] Task 4: Corpus Integration and Semantic Enhancement
- [ ] Task 5: Ingestion Pipeline and Automation
- [ ] Task 6: Quality Assurance and Validation

### **Debug Log**
**2025-08-31**: Task 1 Complete - GitHub-Based OWASP Content Acquisition with ChatGPT Integration
- Created OWASPFetcher for direct GitHub markdown acquisition (raw.githubusercontent.com)
- Implemented secure content fetching from OWASP CheatSheetSeries repository
- Mapped 30 secure coding cheat sheets with full GitHub URLs for direct access
- **Key Innovation**: ChatGPT-based rule card generation with example template guidance
- Script approach: Fetch markdown → Pass to ChatGPT with Rule Card example → Generate YAML
- Created LLMRuleCardGenerator with structured prompts and example Rule Card templates
- Demo script (test_llm_generation.py) shows complete GitHub → ChatGPT → Rule Card pipeline
- Eliminated complex parsing logic in favor of LLM natural language understanding
- Ready for bulk processing with user's OpenAI API key

### **Completion Notes**
[To be filled upon completion]

### **File List**
**New Files:**
- `app/ingestion/owasp_fetcher.py` - Direct GitHub markdown fetcher with 30 cheat sheet URLs
- `app/ingestion/content_parser.py` - Basic markdown structure parser for LLM preparation  
- `app/ingestion/llm_rule_generator.py` - ChatGPT API integration with example Rule Card templates
- `test_llm_generation.py` - Complete demo script: GitHub → ChatGPT → Rule Card YAML
- `validate_task1.py` - Component validation for GitHub fetching and ChatGPT processing

**Modified Files:**
- `app/ingestion/__init__.py` - Updated imports for new components

### **Change Log**
[To be filled during development]

## **Implementation Approach**

### **GitHub-Direct Content Acquisition**
- Source: OWASP CheatSheetSeries GitHub repository markdown files
- Example URL: `https://github.com/OWASP/CheatSheetSeries/blob/master/cheatsheets/JSON_Web_Token_for_Java_Cheat_Sheet.md`
- Fetching: Direct access via `raw.githubusercontent.com` for clean markdown content
- Version Control: Git commit hashes for change tracking and reproducible builds

### **ChatGPT-Based Rule Card Generation**
- Input: Raw OWASP markdown content from GitHub
- Process: Structured ChatGPT prompts with example Rule Card YAML templates
- Output: Standards-compliant Rule Card YAML following established schema
- Benefits: Natural language understanding eliminates complex parsing logic

### **Script-Based Workflow**
1. Fetch markdown from specific GitHub cheat sheet URL
2. Pass content to ChatGPT API with Rule Card example and generation instructions
3. Receive generated Rule Card YAML conforming to established format
4. Validate and integrate into existing rule card collection
5. Repeat for all 30 mapped secure coding cheat sheets

## **Notes**
- Expansion from 15 manually created to 100+ automatically generated Rule Cards
- OWASP provides authoritative, industry-standard security guidance
- LLM approach enables processing of complex, narrative security content
- Generated Rule Cards enhance both compiled rule system and semantic search
- Maintains full compatibility with existing Stories 2.1-2.4 infrastructure