id: NODE-005
title: Use flat Promise chains to avoid Callback Hell
severity: high
scope: web-application
requirement: Avoid nested callback functions in Node.js applications to prevent the
  'Pyramid of Doom' or 'Callback Hell' issue. Utilize Promises for top-down execution
  and error handling to improve code readability and maintainability.
do:
- Refactor asynchronous code to use flat Promise chains
- Utilize .then() and .catch() functions for error handling
- Consider using async/await for cleaner asynchronous code
dont:
- Do not create deeply nested callback functions
- Avoid relying solely on callbacks for error handling
detect:
  semgrep:
  - javascript.nodejs.security.callback-hell
  - javascript.nodejs.security.promise-then-catch
  - javascript.nodejs.security.async-await
  - python.logging.security.audit.logging-sensitive-data
  - java.lang.security.audit.system-exit
  - javascript.express.security.audit.express-expose-sensitive-data
verify:
  tests:
  - Review codebase for nested callback functions
  - Ensure Promises are used consistently for asynchronous operations
  - Validate error handling mechanisms in asynchronous code
refs:
  cwe:
  - CWE-829
  - CWE-691
  owasp:
  - A10:2021
  - A8:2021
